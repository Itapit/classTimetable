{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/timetable.schema.json",
  "title": "Color-Coded Weekly Timetable",
  "type": "object",
  "required": ["version", "periodTemplates", "classes", "groups"],
  "properties": {
    "version": { "type": "string" },

    "periodTemplates": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/periodTemplate" },
      "uniqueItems": true
    },

    "classes": {
      "type": "object",
      "description": "Dictionary of class definitions keyed by classId.",
      "propertyNames": { "pattern": "^[A-Za-z0-9_-]+$" },
      "additionalProperties": { "$ref": "#/$defs/classDef" }
    },

    "groups": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/group" }
    }
  },

  "$defs": {
    "dayOfWeek": {
      "type": "string",
      "enum": [
        "sunday", "monday", "tuesday", "wednesday",
        "thursday", "friday", "saturday"
      ]
    },

    "timeHHMM": {
      "type": "string",
      "pattern": "^(?:[01]\\d|2[0-3]):[0-5]\\d$",
      "description": "24h HH:MM"
    },

    "hexColor": {
      "type": "string",
      "pattern": "^#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})$",
      "description": "CSS hex color, e.g. #2196F3 or #09f"
    },

    "period": {
      "type": "object",
      "required": ["id", "start", "end"],
      "properties": {
        "id": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "name": { "type": "string" },
        "start": { "$ref": "#/$defs/timeHHMM" },
        "end": { "$ref": "#/$defs/timeHHMM" }
      },
      "additionalProperties": false
    },

    "periodTemplate": {
      "type": "object",
      "required": ["id", "label", "periods"],
      "properties": {
        "id": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "label": { "type": "string" },
        "periods": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/period" }
        }
      },
      "additionalProperties": false
    },

    "classDef": {
      "type": "object",
      "required": ["subject", "teacher", "color"],
      "properties": {
        "subject": { "type": "string" },
        "teacher": { "type": "string" },
        "color": { "$ref": "#/$defs/hexColor" }
      },
      "additionalProperties": false
    },

    "scheduleEntry": {
      "type": "object",
      "required": ["periodId", "classId"],
      "properties": {
        "periodId": { "type": "string" },
        "classId": {
          "type": "string",
          "description": "Key in root 'classes' map"
        },
        "room": { "type": "string" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },

    "daySchedule": {
      "type": "object",
      "required": ["day", "classes"],
      "properties": {
        "day": { "$ref": "#/$defs/dayOfWeek" },
        "classes": {
          "type": "array",
          "items": { "$ref": "#/$defs/scheduleEntry" }
        }
      },
      "additionalProperties": false
    },

    "group": {
      "type": "object",
      "required": ["id", "label", "templateId", "week"],
      "properties": {
        "id": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "label": { "type": "string" },
        "templateId": {
          "type": "string",
          "description": "References periodTemplates[].id"
        },
        "applyTemplateToDays": {
          "type": "array",
          "items": { "$ref": "#/$defs/dayOfWeek" },
          "uniqueItems": true,
          "description": "Days that use the templateâ€™s period times."
        },
        "week": {
          "type": "array",
          "description": "Per-day schedule for this group.",
          "items": { "$ref": "#/$defs/daySchedule" }
        }
      },
      "additionalProperties": false
    }
  },

  "additionalProperties": false
}
